<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <link rel="icon" href="./favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MoonTune</title>
  <style>
    .option-button {
      border-radius: 10px;
      background-color: white;
      border: solid 2px #87bdd7;
      font-size: 25px;
      color: #87bdd7;
      margin: 2px;
      padding: 10px;
      min-width: 60px;
    }

    .option-button-focus {
      border-radius: 10px;
      background-color: #2f90b9;
      border: solid 2px #2f90b9;
      font-size: 25px;
      color: white;
      margin: 2px;
      padding: 10px;
      min-width: 60px;
    }

    .wrong-option {
      border-radius: 10px;
      background-color: #c15a5a;
      border: solid 2px #c15a5a;
      font-size: 25px;
      color: white;
      margin: 2px;
      padding: 10px;
      min-width: 60px;
    }

    .right-option {
      border-radius: 10px;
      background-color: #9dce61;
      border: solid 2px #9dce61;
      font-size: 25px;
      color: white;
      margin: 2px;
      padding: 10px;
      min-width: 60px;
    }

    .check-button {
      border-radius: 60px;
      background-color: #f7936c;
      border: 0px;
      font-size: 25px;
      color: white;
      margin: 5px;
      height: 70px;
      width: 80%;
    }

    .right-text {
      border-radius: 5px;
      background-color: #9dce61;
      font-size: 20px;
      color: white;
      margin: 10px;
      padding: 5px;
    }

    .wrong-text {
      border-radius: 5px;
      background-color: #c15a5a;
      font-size: 20px;
      color: white;
      margin: 10px;
      padding: 5px;
    }

    #question-set-select {
      border: #93b5cf 1px solid;
      color: #93b5cf;
      border-radius: 10px;
      font-size: 20px;
      padding: 10px;
      max-width: 400px;
      outline: none;
      margin: 10px;
    }

    #question-text {
      font-size: 40px;
      color: #5e7987;
    }

    .option-form {
      border: solid 1px #93b5cf;
      border-radius: 5px;
      margin: 5px;
      padding: 5px
    }

    .set-button-default {
      border-radius: 10px;
      background-color: white;
      border: solid 2px #87bdd7;
      font-size: 20px;
      color: #87bdd7;
      margin: 2px;
      padding-left: 5px;
    }

    .set-button-selected {
      border-radius: 10px;
      background-color: #2f90b9;
      border: solid 3px #2f90b9;
      font-size: 20px;
      color: white;
      margin: 5px;
      padding-left: 5px;
    }
  </style>
</head>

<body>
  <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <script>
    var json_str = '{"question_sets": [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27], [28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55]], "questions": [{"id": 0, "display_type": 0, "display_content": "0-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 6], "default_answer": [0, -1]}, {"id": 1, "display_type": 0, "display_content": "1-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 3], "default_answer": [0, -1]}, {"id": 2, "display_type": 0, "display_content": "2-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 0], "default_answer": [0, -1]}, {"id": 3, "display_type": 0, "display_content": "3-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 4], "default_answer": [0, -1]}, {"id": 4, "display_type": 0, "display_content": "4-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 1], "default_answer": [0, -1]}, {"id": 5, "display_type": 0, "display_content": "5-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [1, 5], "default_answer": [0, -1]}, {"id": 6, "display_type": 0, "display_content": "6-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [1, 2], "default_answer": [0, -1]}, {"id": 7, "display_type": 0, "display_content": "7-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [0, 5], "default_answer": [0, -1]}, {"id": 8, "display_type": 0, "display_content": "8-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 1], "default_answer": [0, -1]}, {"id": 9, "display_type": 0, "display_content": "9-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 4], "default_answer": [0, -1]}, {"id": 10, "display_type": 0, "display_content": "10-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 0], "default_answer": [0, -1]}, {"id": 11, "display_type": 0, "display_content": "11-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 3], "default_answer": [0, -1]}, {"id": 12, "display_type": 0, "display_content": "12-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 6], "default_answer": [0, -1]}, {"id": 13, "display_type": 0, "display_content": "13-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["A", "B", "C", "D", "E", "F", "G"]], "right_answer": [2, 2], "default_answer": [0, -1]}, {"id": 14, "display_type": 1, "display_content": "G\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 0], "default_answer": [-1, 0]}, {"id": 15, "display_type": 1, "display_content": "D\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 1], "default_answer": [-1, 0]}, {"id": 16, "display_type": 1, "display_content": "A\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 2], "default_answer": [-1, 0]}, {"id": 17, "display_type": 1, "display_content": "E\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 3], "default_answer": [-1, 0]}, {"id": 18, "display_type": 1, "display_content": "B\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 4], "default_answer": [-1, 0]}, {"id": 19, "display_type": 1, "display_content": "\u266fF\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 5], "default_answer": [-1, 0]}, {"id": 20, "display_type": 1, "display_content": "\u266fC\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 6], "default_answer": [-1, 0]}, {"id": 21, "display_type": 1, "display_content": "F\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 0], "default_answer": [-1, 0]}, {"id": 22, "display_type": 1, "display_content": "\u266dB\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 1], "default_answer": [-1, 0]}, {"id": 23, "display_type": 1, "display_content": "\u266dE\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 2], "default_answer": [-1, 0]}, {"id": 24, "display_type": 1, "display_content": "\u266dA\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 3], "default_answer": [-1, 0]}, {"id": 25, "display_type": 1, "display_content": "\u266dD\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 4], "default_answer": [-1, 0]}, {"id": 26, "display_type": 1, "display_content": "\u266dG\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 5], "default_answer": [-1, 0]}, {"id": 27, "display_type": 1, "display_content": "\u266dC\u5927\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 6], "default_answer": [-1, 0]}, {"id": 28, "display_type": 0, "display_content": "0-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 4], "default_answer": [0, -1]}, {"id": 29, "display_type": 0, "display_content": "1-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 1], "default_answer": [0, -1]}, {"id": 30, "display_type": 0, "display_content": "2-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [1, 5], "default_answer": [0, -1]}, {"id": 31, "display_type": 0, "display_content": "3-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [1, 2], "default_answer": [0, -1]}, {"id": 32, "display_type": 0, "display_content": "4-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [1, 6], "default_answer": [0, -1]}, {"id": 33, "display_type": 0, "display_content": "5-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [1, 3], "default_answer": [0, -1]}, {"id": 34, "display_type": 0, "display_content": "6-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [1, 0], "default_answer": [0, -1]}, {"id": 35, "display_type": 0, "display_content": "7-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 3], "default_answer": [0, -1]}, {"id": 36, "display_type": 0, "display_content": "8-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 6], "default_answer": [0, -1]}, {"id": 37, "display_type": 0, "display_content": "9-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 2], "default_answer": [0, -1]}, {"id": 38, "display_type": 0, "display_content": "10-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [0, 5], "default_answer": [0, -1]}, {"id": 39, "display_type": 0, "display_content": "11-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [2, 1], "default_answer": [0, -1]}, {"id": 40, "display_type": 0, "display_content": "12-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [2, 4], "default_answer": [0, -1]}, {"id": 41, "display_type": 0, "display_content": "13-0.png", "options": [["\u266e", "\u266f", "\u266d"], ["a", "b", "c", "d", "e", "f", "g"]], "right_answer": [2, 0], "default_answer": [0, -1]}, {"id": 42, "display_type": 1, "display_content": "e\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 0], "default_answer": [-1, 0]}, {"id": 43, "display_type": 1, "display_content": "b\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 1], "default_answer": [-1, 0]}, {"id": 44, "display_type": 1, "display_content": "\u266ff\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 2], "default_answer": [-1, 0]}, {"id": 45, "display_type": 1, "display_content": "\u266fc\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 3], "default_answer": [-1, 0]}, {"id": 46, "display_type": 1, "display_content": "\u266fg\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 4], "default_answer": [-1, 0]}, {"id": 47, "display_type": 1, "display_content": "\u266fd\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 5], "default_answer": [-1, 0]}, {"id": 48, "display_type": 1, "display_content": "\u266fa\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [0, 6], "default_answer": [-1, 0]}, {"id": 49, "display_type": 1, "display_content": "d\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 0], "default_answer": [-1, 0]}, {"id": 50, "display_type": 1, "display_content": "g\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 1], "default_answer": [-1, 0]}, {"id": 51, "display_type": 1, "display_content": "c\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 2], "default_answer": [-1, 0]}, {"id": 52, "display_type": 1, "display_content": "f\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 3], "default_answer": [-1, 0]}, {"id": 53, "display_type": 1, "display_content": "\u266db\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 4], "default_answer": [-1, 0]}, {"id": 54, "display_type": 1, "display_content": "\u266de\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 5], "default_answer": [-1, 0]}, {"id": 55, "display_type": 1, "display_content": "\u266da\u5c0f\u8c03", "options": [["\u266f", "\u266d"], ["1", "2", "3", "4", "5", "6", "7"]], "right_answer": [1, 6], "default_answer": [-1, 0]}]}'
    var json_data

    var question_set = []

    var right_answers = []

    var my_answers = []

    var img_array = []

    var control_button_status = 0

    window.onload = function () {
      // 图片预加载      
      for (var i = 0; i < 14; i++) {
        for (var j = 0; j < 2; j++) {
          var new_img = new Image()
          new_img.src = "./tuneImg/" + i.toString() + "-" + j.toString() + ".png"
          img_array.push(new_img)
        }
      }
      //加载JSON
      json_data = JSON.parse(json_str)
      console.log(json_data)
      //设置默认set
      document.getElementById("default_set_button").click()
    };

    // 生成新的一题
    function gen_question() {
      //将正确错误信息提示清除
      document.getElementById("res_text").innerText = ""
      document.getElementById("res_text").className = ""

      //随机从set中抽一题
      var question_id = question_set[Math.floor(Math.random() * question_set.length)]
      var one_question_json = json_data.questions[question_id]
      //console.log(one_question_json)

      //清空题干区域
      document.getElementById("question-img").src = ""
      document.getElementById("question-text").innerText = ""

      // 显示题干
      if (one_question_json.display_type == 0) { //题干是图片
        document.getElementById("question-img").src = "./tuneImg/" + one_question_json.display_content
      } else if (one_question_json.display_type == 1) { // 题干是文字
        document.getElementById("question-text").innerText = one_question_json.display_content
      }

      //清空选项区域
      document.getElementById("form_div").innerHTML = null

      //清空答案
      my_answers = []
      //生成选项
      let form_div = document.getElementById("form_div")
      for (var i = 0; i < one_question_json.options.length; i++) {
        //挂上一组选项的div
        var new_form = document.createElement("div")
        new_form.className = "option-form"
        form_div.appendChild(new_form)
        my_answers.push(-1)

        //生成 挂上 按钮
        for (var j = 0; j < one_question_json.options[i].length; j++) {
          var new_button = document.createElement("button")
          new_button.className = "option-button"
          new_button.name = "answer" + i.toString()
          new_button.value = j
          new_button.innerText = one_question_json.options[i][j]
          new_button.setAttribute("onclick", "hit_option()")
          new_form.appendChild(new_button)
          //设置默认答案
          if (j == one_question_json.default_answer[i]) {
            new_button.className = "option-button-focus"
            my_answers[i] = j
          }
        }
      }

      //清空正确答案
      right_answers = []
      for (var i = 0; i < one_question_json.right_answer.length; i++) {
        right_answers.push(one_question_json.right_answer[i])
      }

    }

    // 检查答案是否正确
    function check_answer() {
      //检查答案是否正确
      var is_right = true
      for (var i = 0; i < right_answers.length; i++) {
        //console.log("compare: ", my_answers, right_answers)
        if (my_answers[i] != right_answers[i]) {
          is_right = false
          break
        }
      }
      //设置结果文本
      if (is_right) {
        document.getElementById("res_text").innerText = "答对了(๑•̀ㅂ•́)و✧"
        document.getElementById("res_text").className = "right-text"
      } else {
        document.getElementById("res_text").innerText = "不太对捏(⊙﹏⊙)"
        document.getElementById("res_text").className = "wrong-text"
      }
      //高亮正确与错选项
      for (var i = 0; i < form_div.children.length; i++) {
        for (var j = 0; j < form_div.children[i].children.length; j++) {
          if (form_div.children[i].children[j].value == right_answers[i]) {
            //正确选项
            form_div.children[i].children[j].className = "right-option"
          } else if (form_div.children[i].children[j].value == my_answers[i]) {
            form_div.children[i].children[j].className = "wrong-option"
          }
        }
      }

    }

    // 选项按钮被点击时
    function hit_option() {
      let me = event.target
      // 设置选中样式，重置其他选项的样式
      let name_group = document.getElementsByName(me.name)
      for (var i = 0, length = name_group.length; i < length; i++) {
        name_group[i].className = "option-button"
      }
      me.className = "option-button-focus"

      // 设置answer
      my_answers[parseInt(me.name.slice(6))] = me.value
    }

    // CHECK NEXT按钮被点击时
    function control_button_hit() {
      let me = event.target
      if (control_button_status == 0) {
        gen_question()
        me.innerText = "CHECK"
        control_button_status = 1
      } else if (control_button_status == 1) {
        check_answer()
        me.innerText = "NEXT"
        control_button_status = 0
      }
    }

    //选择题目集的按钮被点击时
    function set_button_hit() {
      let me = event.target
      var my_set = json_data.question_sets[me.value]
      // 未选中->选中
      if (me.className == "set-button-default") {
        //更新样式
        me.className = "set-button-selected"
        //加入问题集
        for (var i = 0; i < my_set.length; i++) {
          question_set.push(my_set[i])
        }
      }
      //选中->未选中
      else if (me.className == "set-button-selected") {
        //更新样式
        me.className = "set-button-default"
        //清空问题集,然后重新加入
        question_set = []
        let set_buttons = document.getElementsByName("set-button")
        for (var i = 0; i < set_buttons.length; i++) {
          if (set_buttons[i].className == "set-button-selected") {
            var new_set = json_data.question_sets[set_buttons[i].value]
            for (var j = 0; j < new_set.length; j++) {
              question_set.push(new_set[j])
            }
          }
        }
      }
      //console.log(question_set)
    }
  </script>
  <div style="width: 100%;text-align: center;">
    <p style="color:rgb(190, 190, 190);">MoonTune Ver 3.2</p>
    <img id="question-img" style="width: 170px;" src="./tuneImg/default.png">
    <p id="question-text"></p>
    <p id="res_text"></p>
  </div>
  <div style="width: 100%;text-align: center;">
    <button id="default_set_button" name="set-button" value=0 onclick="set_button_hit()"
      class="set-button-default">大调</button>
    <button name="set-button" value=1 onclick="set_button_hit()" class="set-button-default">小调</button>
  </div>
  <div id="form_div" style="width: 100%;text-align: center;">
    <div id="option_form_1">
    </div>
    <hr />
    <div id="option_form_2">
    </div>
  </div>
  <div style="width: 100%;text-align: center;position: fixed;bottom: 10px;">
    <button onclick="control_button_hit()" class="check-button">Let's GO ~</button>
  </div>
</body>

</html>
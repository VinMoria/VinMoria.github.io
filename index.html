<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MoonTune</title>
  <style>
    .option-button {
      border-radius: 5px;
      background-color: white;
      border: solid 2px #5e7987;
      font-size: 20px;
      color: #5e7987;
      margin: 2px;
      height: 60px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .option-button-focus {
      border-radius: 5px;
      background-color: #2f90b9;
      border: solid 3px #2f90b9;
      font-size: 25px;
      color: white;
      margin: 5px;
      height: 70px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .check-button {
      border-radius: 60px;
      background-color: #ffc209;
      border: 0px;
      font-size: 25px;
      color: white;
      margin: 5px;
      height: 70px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .next-button {
      border-radius: 60px;
      background-color: #f44235;
      border: 0px;
      font-size: 25px;
      color: white;
      margin: 5px;
      height: 70px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .right-text {
      border-radius: 5px;
      background-color: #9dce61;
      font-size: 20px;
      color: white;
      margin: 10px;
      padding: 5px;
    }

    .wrong-text {
      border-radius: 5px;
      background-color: #c15a5a;
      font-size: 20px;
      color: white;
      margin: 10px;
      padding: 5px;
    }
  </style>
</head>

<body>
  <script>
    //调号的升降
    var option1_text = ["♮", "♯", "♭"]
    //调号
    var option2_text = "ABCDEFG"
    //记号的升降
    var option3_text = ["♯", "♭"]
    //升降记号数量
    var option4_text = "1234567"

    var answer_array_type1 = [[0, 6], [0, 3], [0, 0], [0, 4], [0, 1], [1, 5], [1, 2], [0, 5], [2, 1], [2, 4], [2, 0], [2, 3], [2, 6], [2, 2]]

    var right_answer1
    var right_answer2

    var answer1
    var answer2

    function gen_question() {
      document.getElementById("res_text").innerText = ""
      document.getElementById("res_text").className = ""
      var type = Math.floor(Math.random() * 2)
      var tune_no = Math.floor(Math.random() * 14)
      if (type == 0) {
        right_answer1 = answer_array_type1[tune_no][0]
        right_answer2 = answer_array_type1[tune_no][1]
      } else {
        right_answer1 = (Math.floor(tune_no / 7)).toString()
        right_answer2 = (tune_no % 7).toString()
      }
      console.log("right-answer:")
      console.log(right_answer1, right_answer2)

      gen_option(type)
      let question_img = document.getElementById("question-img")
      question_img.src = "./tuneImg/" + tune_no.toString() + "-" + type.toString() + ".png"
    }

    function check_answer() {

      console.log(answer1, answer2)
      if (answer1 == right_answer1 & answer2 == right_answer2) {
        document.getElementById("res_text").innerText = "答对了 (ง •̀_•́)ง‼"
        document.getElementById("res_text").className = "right-text"
      } else {
        document.getElementById("res_text").innerText = "不太对捏( ó × ò)"
        document.getElementById("res_text").className = "wrong-text"
      }
    }

    function gen_option(type) {
      let option_form_1 = document.getElementById("option_form_1")
      let option_form_2 = document.getElementById("option_form_2")

      option_form_1.innerHTML = null
      option_form_2.innerHTML = null

      answer1 = null
      answer2 = null

      if (type == 0) { //根据图像选调号
        answer1 = "0"
        // 还原，升，降
        var new_button = document.createElement("button")
        new_button.className = "option-button-focus"
        new_button.name = "answer1"
        new_button.value = 0
        new_button.innerText = option1_text[0]
        new_button.setAttribute("onclick", "hit_button()")
        option_form_1.appendChild(new_button)

        for (var i = 1; i < 3; i++) {
          var new_button = document.createElement("button")
          new_button.className = "option-button"
          new_button.name = "answer1"
          new_button.value = i
          new_button.innerText = option1_text[i]
          new_button.setAttribute("onclick", "hit_button()")
          option_form_1.appendChild(new_button)
        }

        // X大调
        for (var i = 0; i < 7; i++) {
          var new_button = document.createElement("button")
          new_button.className = "option-button"
          new_button.name = "answer2"
          new_button.value = i
          new_button.innerText = option2_text.charAt(i)
          new_button.setAttribute("onclick", "hit_button()")
          option_form_2.appendChild(new_button)
        }
      } else { //根据调号选图像
        // 升，降
        for (var i = 0; i < 2; i++) {
          var new_button = document.createElement("button")
          new_button.className = "option-button"
          new_button.name = "answer1"
          new_button.value = i
          new_button.innerText = option3_text[i]
          new_button.setAttribute("onclick", "hit_button()")
          option_form_1.appendChild(new_button)
        }

        // 几个
        for (var i = 0; i < 7; i++) {
          var new_button = document.createElement("button")
          new_button.className = "option-button"
          new_button.name = "answer2"
          new_button.value = i
          new_button.innerText = (i + 1).toString()
          new_button.setAttribute("onclick", "hit_button()")
          option_form_2.appendChild(new_button)
        }
      }
    }

    function hit_button() {
      let me = event.target
      // 设置选中样式
      let name_group = document.getElementsByName(me.name)
      for (var i = 0, length = name_group.length; i < length; i++) {
        name_group[i].className = "option-button"
      }
      me.className = "option-button-focus"

      // 设置answer
      if (me.name == "answer1") {
        answer1 = me.value
      } else if (me.name == "answer2") {
        answer2 = me.value
      }
    }

  </script>
  <div style="height: 40vh;width: 100%;text-align: center;padding: auto;">
    <img id="question-img" style="margin: auto;" src="./tuneImg/default.png">
    <p id="res_text"></p>
  </div>
  <div style="height: 30vh;width: 100%;text-align: center;">
    <div id="option_form_1">
    </div>

    <hr />

    <div id="option_form_2">
    </div>
  </div>
  <div style="height: 15vh;width: 100%;text-align: center;">
    <button onclick="check_answer()" class="check-button">CHECK</button>
    <button onclick="gen_question()" class="next-button">NEXT</button>
  </div>
</body>

</html>